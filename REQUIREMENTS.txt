=============================================================================
SISTEMA DE AGENDAMENTOS CRAS - REQUISITOS E DEPEND√äNCIAS
=============================================================================

üìã √çNDICE
---------
1. Requisitos de Sistema
2. Depend√™ncias de Produ√ß√£o (Frontend)
3. Depend√™ncias de Desenvolvimento (Frontend)
4. Depend√™ncias de Produ√ß√£o (Backend)
5. Banco de Dados
6. Vari√°veis de Ambiente
7. Configura√ß√£o de Seguran√ßa
8. Instala√ß√£o e Deploy


=============================================================================
1. REQUISITOS DE SISTEMA
=============================================================================

‚úÖ Node.js: v18.x ou superior (recomendado: v20.x LTS)
‚úÖ npm: v9.x ou superior
‚úÖ MongoDB: v6.x ou superior
‚úÖ Sistema Operacional: Linux (Ubuntu/Debian), macOS, ou Windows com WSL2
‚úÖ Mem√≥ria RAM: M√≠nimo 2GB (recomendado: 4GB+)
‚úÖ Espa√ßo em Disco: M√≠nimo 1GB livre


=============================================================================
2. DEPEND√äNCIAS DE PRODU√á√ÉO (FRONTEND)
=============================================================================

Framework Principal:
--------------------
react                      ^19.1.0      - Biblioteca UI
react-dom                  ^19.1.0      - Renderiza√ß√£o DOM
react-router-dom           ^6.30.1      - Roteamento SPA

Material-UI (Design System):
-----------------------------
@mui/material              ^7.1.1       - Componentes UI
@mui/icons-material        ^7.1.1       - √çcones Material Design
@mui/x-date-pickers        ^8.5.1       - Date Pickers
@emotion/react             ^11.14.0     - CSS-in-JS
@emotion/styled            ^11.14.0     - Styled Components

Utilit√°rios:
------------
axios                      ^1.9.0       - Cliente HTTP
date-fns                   ^4.1.0       - Manipula√ß√£o de datas
joi                        ^18.0.2      - Valida√ß√£o de schemas


=============================================================================
3. DEPEND√äNCIAS DE DESENVOLVIMENTO (FRONTEND)
=============================================================================

Build Tools:
------------
vite                       ^6.3.5       - Build tool e dev server
@vitejs/plugin-react       ^4.4.1       - Plugin Vite para React

Linting:
--------
eslint                     ^9.25.0      - Linter JavaScript
@eslint/js                 ^9.25.0      - Configura√ß√µes ESLint
eslint-plugin-react-hooks  ^5.2.0       - Regras React Hooks
eslint-plugin-react-refresh ^0.4.19     - Hot reload React
globals                    ^16.0.0      - Vari√°veis globais

Type Definitions:
-----------------
@types/react               ^19.1.2      - Tipos TypeScript React
@types/react-dom           ^19.1.2      - Tipos TypeScript React DOM


=============================================================================
4. DEPEND√äNCIAS DE PRODU√á√ÉO (BACKEND)
=============================================================================

Framework e Core:
-----------------
express                    ^5.1.0       - Framework web Node.js
mongoose                   ^8.15.1      - ODM MongoDB
dotenv                     ^16.5.0      - Carregador .env

Autentica√ß√£o e Seguran√ßa:
-------------------------
jsonwebtoken               ^9.0.2       - JWT tokens
bcryptjs                   ^3.0.2       - Hash de senhas
cookie-parser              ^1.4.7       - Parser de cookies
helmet                     ^8.1.0       - Security headers HTTP
cors                       ^2.8.5       - CORS middleware
express-mongo-sanitize     ^2.2.0       - Sanitiza√ß√£o MongoDB
express-rate-limit         ^8.2.1       - Rate limiting

Valida√ß√£o e Logging:
--------------------
joi                        ^18.0.2      - Valida√ß√£o de schemas
winston                    ^3.18.3      - Sistema de logs


=============================================================================
5. BANCO DE DADOS - MongoDB Atlas (Cloud)
=============================================================================

‚òÅÔ∏è Este sistema utiliza EXCLUSIVAMENTE MongoDB Atlas (cloud)
üìå Crie sua conta gratuita em: https://cloud.mongodb.com

Plano Gratuito (M0 Free Tier):
------------------------------
‚úÖ 512 MB de armazenamento
‚úÖ Shared RAM e vCPU
‚úÖ At√© 500 conex√µes simult√¢neas
‚úÖ Backups autom√°ticos
‚úÖ Sem custo para sempre

Collections Principais:
-----------------------
‚úÖ users           - Usu√°rios do sistema (admin, coordenador, t√©cnico, recepcionista)
‚úÖ cras            - Centros de Refer√™ncia (unidades)
‚úÖ appointments    - Agendamentos (com dados criptografados)
‚úÖ blockedslots    - Bloqueios de hor√°rios
‚úÖ logs            - Logs de auditoria do sistema

Configura√ß√£o MongoDB Atlas:
---------------------------
1. Acesse https://cloud.mongodb.com
2. Crie um cluster M0 (Free)
3. Em "Database Access": crie usu√°rio com senha forte
4. Em "Network Access": adicione IP 0.0.0.0/0 (permite qualquer IP)
5. Em "Connect": copie a connection string
6. Substitua <password> pela senha criada

√çndices Criados:
----------------
‚úÖ users.cpf (unique)
‚úÖ users.cras (refer√™ncia)
‚úÖ cras.nome (unique)
‚úÖ appointments.date + time + cras
‚úÖ appointments.userCpf
‚úÖ blockedslots.date + startTime


=============================================================================
6. VARI√ÅVEIS DE AMBIENTE (.env)
=============================================================================

‚ö†Ô∏è CRITICAL - NUNCA COMMITAR ARQUIVO .env ‚ö†Ô∏è

Backend (.env obrigat√≥rio):
---------------------------

# MongoDB Atlas Configuration (OBRIGAT√ìRIO)
MONGODB_URI=mongodb+srv://[user]:[password]@[cluster].mongodb.net/[database]?retryWrites=true&w=majority
   Exemplo: mongodb+srv://cras_admin:SenhaForte123@cluster0.abc123.mongodb.net/agendamentos?retryWrites=true&w=majority
   
   üìå Obtenha sua URI em: https://cloud.mongodb.com > Connect > Drivers
   ‚ö†Ô∏è Substitua <password> pela senha do usu√°rio criado no Atlas

# JWT Configuration (gerar com: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))")
JWT_SECRET=[128 caracteres hexadecimais]
   Exemplo: 7b9f0d0886fba81b1102736104103188...
   ‚ö†Ô∏è NUNCA reutilizar em ambientes diferentes!

JWT_REFRESH_SECRET=[128 caracteres hexadecimais]
   Exemplo: 35332537be449064435d9131a20d08d4...
   ‚ö†Ô∏è DEVE ser diferente do JWT_SECRET!

# Encryption Configuration
ENCRYPTION_KEY=[string qualquer - NUNCA ALTERAR]
   Exemplo: seu_segredo_jwt_super_secreto_aqui_troque_em_producao
   ‚ö†Ô∏è CR√çTICO: Se alterar, TODOS os dados criptografados (CPF, nomes, telefones) 
                ficar√£o ILEG√çVEIS permanentemente! Backup obrigat√≥rio antes de qualquer mudan√ßa!

# Server Configuration
PORT=5000
NODE_ENV=development|production
FRONTEND_URL=http://localhost:5173


Frontend (.env.local opcional):
-------------------------------
VITE_API_BASE_URL=http://localhost:5000/api

Produ√ß√£o (Vercel - configurar no dashboard):
-------------------------------
VITE_API_BASE_URL=https://cras-agendamentos.onrender.com/api


=============================================================================
7. CONFIGURA√á√ÉO DE SEGURAN√áA
=============================================================================

üîí Seguran√ßa Implementada:
---------------------------

‚úÖ JWT com httpOnly cookies (n√£o acess√≠vel via JavaScript)
‚úÖ Cookies com flags: secure, httpOnly, sameSite=Strict
‚úÖ Rate limiting (20 requests/15min por IP)
‚úÖ Helmet.js (security headers HTTP)
‚úÖ CORS restrito ao FRONTEND_URL
‚úÖ Sanitiza√ß√£o de queries MongoDB
‚úÖ Criptografia AES-256-CBC para dados sens√≠veis (CPF, nomes, telefones)
‚úÖ Hash bcrypt para senhas (salt rounds: 10)
‚úÖ Valida√ß√£o Joi em todas as rotas
‚úÖ Logs de auditoria com Winston
‚úÖ DevTools detection (anti-debugging frontend)
‚úÖ CSP (Content Security Policy) via meta tags

üîê Dados Criptografados no Banco:
----------------------------------
‚úÖ CPF dos usu√°rios e agendamentos
‚úÖ Nomes completos
‚úÖ N√∫meros de telefone

‚ö†Ô∏è IMPORTANTE: A ENCRYPTION_KEY NUNCA pode ser alterada ap√≥s o primeiro
   registro no banco, caso contr√°rio TODOS os dados ficar√£o ileg√≠veis!


=============================================================================
8. INSTALA√á√ÉO E DEPLOY
=============================================================================

Instala√ß√£o Local:
-----------------

1. Clonar reposit√≥rio:
   $ git clone [repo-url]
   $ cd CRAS-Agendamentos

2. Configurar MongoDB Atlas (Gratuito):
   a) Acesse https://cloud.mongodb.com e crie uma conta
   b) Crie um cluster M0 (Free Tier)
   c) Em "Database Access": crie um usu√°rio com senha
   d) Em "Network Access": adicione 0.0.0.0/0 (acesso de qualquer IP)
   e) Em "Connect" > "Drivers": copie a connection string

3. Configurar Backend:
   $ cd backend
   $ npm install
   $ cp .env.example .env
   $ nano .env  # Configurar MONGODB_URI com a string do Atlas
   $ node server.js

4. Configurar Frontend:
   $ cd ..
   $ npm install
   $ npm run dev

5. Acessar aplica√ß√£o:
   Frontend: http://localhost:5173
   Backend API: http://localhost:5000


Deploy em Produ√ß√£o:
-------------------

1. Vari√°veis de Ambiente:
   ‚ö†Ô∏è Gerar novos secrets FORTES para JWT_SECRET e JWT_REFRESH_SECRET
   ‚ö†Ô∏è Configurar MongoDB com TLS/SSL
   ‚ö†Ô∏è NODE_ENV=production
   ‚ö†Ô∏è Configurar FRONTEND_URL com dom√≠nio real

2. Build Frontend:
   $ npm run build
   $ # Servir arquivos da pasta dist/ com nginx/apache

3. Backend em PM2:
   $ npm install -g pm2
   $ cd backend
   $ pm2 start server.js --name cras-api
   $ pm2 startup
   $ pm2 save

4. Nginx Reverse Proxy:
   server {
       listen 80;
       server_name api.seudominio.com;
       
       location / {
           proxy_pass http://localhost:5000;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }

5. HTTPS com Let's Encrypt:
   $ sudo apt install certbot python3-certbot-nginx
   $ sudo certbot --nginx -d api.seudominio.com


=============================================================================
SEGURAN√áA - CHECKLIST PR√â-DEPLOY
=============================================================================

‚úÖ .env adicionado ao .gitignore
‚úÖ .env.backup* adicionado ao .gitignore
‚úÖ headers.txt deletado (cont√©m tokens reais)
‚úÖ JWT_SECRET e JWT_REFRESH_SECRET gerados com 128+ caracteres
‚úÖ MongoDB com autentica√ß√£o habilitada
‚úÖ MONGO_URI com senha forte (m√≠nimo 20 caracteres)
‚úÖ NODE_ENV=production configurado
‚úÖ FRONTEND_URL configurado com dom√≠nio real (sem http://localhost)
‚úÖ Rate limiting configurado e testado
‚úÖ CORS restrito ao dom√≠nio do frontend
‚úÖ Helmet.js habilitado com todas as headers
‚úÖ Logs configurados (Winston) para arquivo + console
‚úÖ Backup da ENCRYPTION_KEY em local seguro (cofre, vault)
‚úÖ Firewall configurado (apenas portas 80, 443, 22 abertas)
‚úÖ MongoDB binding apenas localhost ou rede privada
‚úÖ SSL/TLS configurado (Let's Encrypt)
‚úÖ Testes de penetra√ß√£o realizados
‚úÖ Processo de rota√ß√£o de secrets documentado


=============================================================================
MANUTEN√á√ÉO E ATUALIZA√á√ïES
=============================================================================

Verificar vulnerabilidades:
---------------------------
$ npm audit
$ npm audit fix

Atualizar depend√™ncias:
-----------------------
$ npm outdated
$ npm update
$ npm install <package>@latest

Backup MongoDB Atlas:
---------------------
# Via mongodump (instale mongodb-database-tools)
$ mongodump --uri="mongodb+srv://user:pass@cluster.mongodb.net/agendamentos" --out=/backup/

# Ou use o backup autom√°tico do Atlas (gratuito no M0):
# Atlas > Database > Backups > Take Snapshot Now

Restore MongoDB Atlas:
----------------------
$ mongorestore --uri="mongodb+srv://user:pass@cluster.mongodb.net" --db=agendamentos /backup/agendamentos/


=============================================================================
SUPORTE E DOCUMENTA√á√ÉO
=============================================================================

üìß Contato: Gabriel Julek
üìÅ Reposit√≥rio: [repo-url]
üìñ Documenta√ß√£o: README.md
üîß Changelog: CHANGELOG.md

Vers√£o: 1.0.0
√öltima atualiza√ß√£o: 2025-11-21
=============================================================================
